{% extends "base.html" %}
{% block title %}{% i18n "VMs" %} - {{ domain.name }}{% endblock %}
{% block content %}
    {% include 'sidebar.html' %}
    <div class="col-md-9 col-md-offset-2 content">
    {% if errors %}
        {% for error in errors %}
	    <script type="text/javascript">
                function ShowAlert() {
                     var title = 'FleetCompute Errors';

                    return eModal
                              .alert('{{ error }}' , title);
                     };
             </script>
        {% endfor %}
    {% endif %}
    {% if messages %}
        {% for message in messages %}
          <script type="text/javascript">
                function ShowMessage() {
                        toastr.options = {
                          "closeButton": true,
                          "debug": false,
                          "newestOnTop": false,
                          "progressBar": true,
                          "positionClass": "toast-bottom-center",
                          "preventDuplicates": false,
                          "onclick": null,
                          "showDuration": "300",
                          "hideDuration": "1000",
                          "timeOut": "5000",
                          "extendedTimeOut": "1000",
                          "showEasing": "swing",
                          "hideEasing": "linear",
                          "showMethod": "fadeIn",
                          "hideMethod": "fadeOut"
                        }
                    return toastr.success('{{ message }}',"FleetCompute");
                     };
             </script>
        {% endfor %}
    {% endif %}
  <br>             
   <div class="table-responsive">
    <table class="table">
        <thead>
        <tr class="active">
            <th>{% i18n "Name" %}</th>
            <th>{% i18n "Status" %}</th>
            <th>{% i18n "VCPUs" %}</th>
            <th>{% i18n "Memory" %}</th>
            <th>{% i18n "AutoStart" %}</th>
            <th>{% i18n "Description" %}</th>
            <th>{% i18n "Created" %}</th>
            <th>{% i18n "Last Modified" %}</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>{{ domain.name }}</td>
            <td>{% if domain.status %}
                <span id="status" class={% if domain.status == 5 %}
                    {% if domain.hasManagedSaveImage == 1 %}
                        "label label-warning">{% i18n "Saved" %}
                    {% else %}
                        "label label-danger">{% i18n "Shutoff" %}
                    {% endif %}
                {% endif %}
                {% if domain.status == 1 %}"label label-success">{% i18n "Running" %}{% endif %}
                {% if domain.status == 3 %}"label label-warning">{% i18n "Suspended" %}{% endif %}
                            </span>
            {% else %}
                {% i18n "None" %}
            {% endif %}
            </td>
            <td>{% if domain.currentVcpu %}{{ domain.currentVcpu }}{% else %}{{ domain.vcpu }}{% endif %}</td>
            <td>{{ domain.currentMemoryPretty }}</td>
            <td>{{ domain.autostart }}</td>
            <td>{{ domain.description }}</td>
            <td>{{ domain.creationTime }}</td>
            <td>{{ domain.lastModificationTime }}</td>
        <tr>
        </tbody>
    </table>
</div>

    <hr>
    <ul id="btnsection" class="nav nav-tabs">
        <li class="active">
            <a id="tab_power" class="inst-btn" href="#power" data-toggle="tab">
                <span class="fas fa-power-off"></span><br>{% i18n "Power" %}
            </a>
        </li>
        <li><a id="tab_access" class="inst-btn" href="#access" data-toggle="tab">
            <span class="fas fa-desktop"></span><br>{% i18n "Access" %}
        </a>
        </li>
        <li><a id="tab_snapshots" class="inst-btn" href="#snapshots" data-toggle="tab">
            <span class="fas fa-camera"></span><br>{% i18n "Snapshots" %}
        </a>
        </li>
        <li><a id="tab_graph" class="inst-btn" href="#graph" data-toggle="tab">
            <span class="fas fa-chart-bar"></span><br>{% i18n "Statistics" %}
        </a>
        </li>
        <li><a id="tab_settings" class="inst-btn" href="#settings" data-toggle="tab">
            <span class="fas fa-cogs"></span><br>{% i18n "Settings" %}
        </a>
        </li>
       <!-- <li><a class="inst-btn" href="#migrate" data-toggle="tab">
            <span class="glyphicon glyphicon-cloud-download"></span><br>{% i18n "Migrate" %}
        </a>
       </li>-->
        <li><a id="tab_delete" class="inst-btn" href="#delete" data-toggle="tab">
            <span class="fas fa-trash-alt"></span><br>{% i18n "Destroy" %}
        </a>
        </li>
    </ul>
    <div class="tab-content">
    <div class="tab-pane active" id="power" style="margin-top: 20px">
        <ul class="nav nav-tabs">
            <li class="active"><a id="tab_shutdown" href="#shutdown" data-toggle="tab">{% if domain.status == 5 %}{% i18n "Start" %}{% else %}{% i18n "Shutdown" %}{% endif %}</a></li>
            {% if domain.status != 5 %}
            <li><a id="tab_forceshutdown" href="#forceshutdown" data-toggle="tab">{% i18n "Force Shutdown" %}</a></li>
            <li><a id="tab_suspend" href="#suspend" data-toggle="tab">{% i18n "Suspend" %}</a></li>
            {% endif %}
            <!--{% if domain.status != 5 or domain.hasManagedSaveImage == 1 %}
            <li><a href="#managedsave" data-toggle="tab">{% i18n "Save" %}</a></li>
	    {% endif %}-->
        </ul>
        <div class="tab-content">
            <div class="tab-pane tab-inst active" id="shutdown">
                {% if domain.status == 5 %}
                <p>{% i18n "Click on Start button to start this instance." %}</p>
                {% else %}
                <p>{% i18n "This action sends an ACPI shutdown signal to the instance." %}</p>
                {% endif %}

                <form action="" method="post" role="form">{% c_csrf_token %}
                    {% if domain.status == 5 %}
                        <button type="submit" name="start"
                                class="btn btn-lg btn-primary pull-left">{% i18n "Start" %}</button>
                    {% endif %}
                    {% if domain.status == 1 %}
                        <button data-id="shutoff" type="submit" name="power" value="shutdown"
                                class="btn btn-lg btn-primary pull-left"
                                onclick="return confirm('{% i18n "Are you sure?" %}')">{% i18n "Shutdown" %}</button>
                    {% endif %}
                    {% if domain.status == 3 %}
                        <button class="btn btn-lg btn-primary pull-left disabled">{% i18n "Shutdown" %}</button>
                    {% endif %}
                </form>
                <div class="clearfix"></div>
            </div>
            {% if domain.status != 5 %}
            <div class="tab-pane tab-inst" id="forceshutdown">
                <p>{% i18n "This action forcibly powers off the instance and may cause data corruption." %}</p>

                <form action="" method="post" role="form">{% c_csrf_token %}
                    {% if domain.status == 1 %}
                        <button data-id="shutoff" type="submit" name="power" value="destroy"
                                class="btn btn-lg btn-primary pull-left"
                                onclick="return confirm('{% i18n "Are you sure?" %}')">{% i18n "Force Shutdown" %}</button>
                    {% endif %}
                    {% if domain.status == 3 %}
                        <button class="btn btn-lg btn-primary pull-left disabled">{% i18n "Force Shutdown" %}</button>
                    {% endif %}
                </form>
                <div class="clearfix"></div>
            </div>
            <div class="tab-pane tab-inst" id="suspend">
                <p>{% i18n "This action suspends or restores the instance." %}</p>

                <form action="" method="post" role="form">{% c_csrf_token %}
                    {% if domain.status == 1 %}
                        <button data-id="shutoff" type="submit" name="suspend"
                                class="btn btn-lg btn-primary pull-left"
                                onclick="return confirm('{% i18n "Are you sure?" %}')">{% i18n "Suspend" %}</button>
                    {% endif %}
                    {% if domain.status == 3 %}
                        <button type="submit" name="resume"
                                class="btn btn-lg btn-primary pull-left">{% i18n "Resume" %}</button>
                    {% endif %}
                </form>
                <div class="clearfix"></div>
            </div>
            {% endif %}
            <!--{% if status != 5 or domain.hasManagedSaveImage == 1 %}
            <div class="tab-pane tab-inst" id="managedsave">
                <p>{% i18n "This action saves the state of the instance." %}</p>

                <form action="" method="post" role="form">{% c_csrf_token %}
                    {% if domain.status == 5 %}
                        <button data-id="shutoff" type="submit" name="start"
                                class="btn btn-lg btn-primary pull-left">{% i18n "Start" %}</button>
                        {% if domain.hasManagedSaveImage == 1 %}
                            <div class="clearfix" style="height:60px;"></div>
                            <button type="submit" name="deletesaveimage"
                                    class="btn btn-lg btn-primary pull-left">{% i18n "Delete Save Image" %}</button>
                        {% endif %}
                    {% endif %}
                    {% if domain.status == 1 %}
                        <button type="submit" name="power" value="managedsave"
                                class="btn btn-lg btn-primary pull-left"
                                onclick="return confirm('{% i18n "Are you sure?" %}')">{% i18n "Save" %}</button>
                    {% endif %}
                    {% if domain.status == 3 %}
                        <button class="btn btn-lg btn-primary pull-left disabled">{% i18n "Save" %}</button>
                    {% endif %}
                </form>
                <div class="clearfix"></div>
            </div>
	    {% endif %}-->
        </div>
    </div>
    <div class="tab-pane" id="access" style="margin-top: 20px">
        <ul class="nav nav-tabs">
            <li class="active"><a id="tab_console" href="#console" data-toggle="tab">{% i18n "Console" %}</a></li>
            <li><a id="tab_console_type" href="#console_type" data-toggle="tab">{% i18n "Console Type" %}</a></li>
            <li><a id="tab_console_pass" href="#console_pass" data-toggle="tab">{% i18n "Console Password" %}</a></li>
            <li><a id="tab_console_keymap" href="#console_keymap" data-toggle="tab">{% i18n "Console Keymap" %}</a></li>
            {% if telnet_port %}
                <li><a href="#telnet_console" data-toggle="tab">{% i18n "Telnet Console" %}</a></li>
            {% endif %}

        </ul>
        <div class="tab-content">
            <div class="tab-pane tab-inst active" id="console">
                <p>{% i18n "This action opens a new window with a connection to the console of the instance." %}</p>
                {% if domain.status == 5 %}
                    <button class="btn btn-primary btn-lg pull-left disabled">{% i18n "Console" %}</button>
                {% else %}
                    <a href="#" class="btn btn-primary btn-lg pull-left" title="Console port: {{ console_port }}"
                       onclick="open_console()">{% i18n "Console" %}</a>
                {% endif %}
                <div class="clearfix"></div>
            </div>
            <div class="tab-pane tab-inst" id="telnet_console">
                <p>{% i18n "This action open new window with console Telnet connection to your instance." %}</p>
                {% if domain.status == 5 %}
                    <button class="btn btn-primary btn-lg pull-left disabled">{% i18n "Console" %}</button>
                {% else %}
                    <a href="telnet://{{ compute.hostname }}:{{ telnet_port }}"
                       class="btn btn-primary btn-lg pull-left"
                       title="Telnet Port: {{ telnet_port }}">{% i18n "Console" %}</a>
                {% endif %}
                <div class="clearfix"></div>
            </div>
            <div class="tab-pane tab-inst" id="console_type">
                <p>{% i18n "To set the console's type, shut down the instance." %}</p>

                <form class="form-horizontal" method="post" role="form">{% c_csrf_token %}
                    <div class="form-group" id="console_type_selection">
                        <label for="console_select_type" class="col-sm-2 control-label">{% i18n "Type" %}</label>

                        <div class="col-sm-6">
                            <select id="console_select_type" class="form-control" name="console_type">
                                <option value="" style="font-weight: bold">{% i18n "please choose" %}</option>
                                {% for ctype in console_types %}
                                    <option value="{{ ctype }}">{{ ctype }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    {% if domain.status == 5 %}
                        <button type="submit" class="btn btn-primary btn-lg pull-left"
                                name="set_console_type">{% i18n "Set console type" %}</button>
                    {% else %}
                        <button class="btn btn-primary btn-lg pull-left disabled"
                                name="set_console_type">{% i18n "Set console type" %}</button>
                    {% endif %}
                </form>
                <div class="clearfix"></div>
            </div>
            <div class="tab-pane tab-inst" id="console_pass">
                <p>{% i18n "To create the console password, shut down the instance." %}</p>

                <form class="form-horizontal" method="post" role="form">{% c_csrf_token %}
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="auto_pass" value="true"
                                           id="console_passwd_gen">{% i18n "Generate" %}
                                </label>
                            </div>
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="clear_pass" value="true"
                                           id="console_passwd_clear">{% i18n "Clear" %}
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="console_passwd_manual">
                        <label for="inputPassword1" class="col-sm-2 control-label">{% i18n "Password" %}</label>

                        <div class="col-sm-6">
                            <input id="console_show_pass" type="password" class="form-control" name="console_passwd"
                                   {% if domain.consolePassword %}
                                        value="{{ domain.consolePassword }}"
                                   {% else %}
                                        placeholder="{% i18n "Password" %}{{ domain.consolePassword }}"
                                   {% endif %} maxlength="14">
                        </div>
                        {% if console_passwd %}
                            <a href="#" name="console_show" class="btn btn-primary btn-md"
                                onclick="show_console()">{% i18n "Show" %}</a>
                        {% endif %}
                    </div>
                    {% if domain.status == 5 %}
                        <button type="submit" class="btn btn-primary btn-lg pull-left"
                                name="set_console_passwd">{% i18n "Set Password" %}</button>
                    {% else %}
                        <button class="btn btn-primary btn-lg pull-left disabled"
                                name="set_console_passwd">{% i18n "Set Password" %}</button>
                    {% endif %}
                </form>
                <div class="clearfix"></div>
            </div>
            <div class="tab-pane tab-inst" id="console_keymap">
                <p>{% i18n "To set the console's keymap, shut down the instance." %}</p>

                <form class="form-horizontal" method="post" role="form">{% c_csrf_token %}
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="clear_keymap" value="true"
                                           id="console_keymap_clear">{% i18n "Clear" %}
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="console_keymap_selection">
                        <label for="console_select_keymap" class="col-sm-2 control-label">{% i18n "Keymap" %}</label>

                        <div class="col-sm-6">
                            <select id="console_select_keymap" class="form-control" name="console_keymap">
                                <option value="" style="font-weight: bold">{% i18n "please choose" %}</option>
                                {% for keymap in keymaps %}
                                    <option value="{{ keymap }}">{{ keymap }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    {% if domain.status == 5 %}
                        <button type="submit" class="btn btn-primary btn-lg pull-left"
                                name="set_console_keymap">{% i18n "Set Keymap" %}</button>
                    {% else %}
                        <button class="btn btn-primary btn-lg pull-left disabled"
                                name="set_console_keymap">{% i18n "Set Keymap" %}</button>
                    {% endif %}
                </form>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
    <div class="tab-pane" id="settings" style="margin-top: 20px">
    <ul class="nav nav-tabs" style="margin-top: 20px">
        <li class="active"><a class="inst-btn" id="settings_instancesettings" href="#instancesettings" data-toggle="tab"><span class="fas fa-microchip"></span><span class="fas fa-memory"></span>{% i18n "CPU/Ram" %}</a></li>
        <li><a class="inst-btn" id="settings_instancemedia" href="#instancemedia" data-toggle="tab"><span class="fas fa-compact-disc"></span><br>{% i18n "Media" %}</a></li>
        <li><a class="inst-btn" id="settings_instancenetworks" href="#instancenetworks" data-toggle="tab"><span class="fas fa-network-wired"></span>{% i18n "Network" %}</a></li>
        <li><a class="inst-btn" id="settings_instancedisks" href="#instancedisks" data-toggle="tab"><span class="fas fa-hdd"></span><br>{% i18n " Disks " %}</a></li>
        <li><a class="inst-btn" id="settings_instanceclone" href="#instanceclone" data-toggle="tab"><span class="fas fa-clone"></span><br>{% i18n " Clone " %}</a>
    </ul>
    <div class="tab-content">
    <div class="tab-pane tab-inst active" id="instancesettings">
        <p style="font-weight:bold;">{% i18n "Boot Settings" %}</p>

        <form class="form-horizontal" action="" method="post" role="form">{% c_csrf_token %}
            <div class="form-group">
                <label class="col-sm-4 control-label" style="font-weight:normal;"> {% i18n "Autostart" %}</label>

                <div class="col-sm-4">
                    {% if not domain.autostart %}
                        <input type="submit" class="btn btn-md btn-default" name="set_autostart"
                               value="{% i18n "Enable" %}">
                    {% else %}
                        <input type="submit" class="btn btn-md btn-default" name="unset_autostart"
                               value="{% i18n "Disable" %}">
                    {% endif %}
                </div>
            </div>
        </form>
        <form class="form-horizontal" action="" method="post" role="form">{% c_csrf_token %}
            <div class="form-group">
                <label class="col-sm-4 control-label" style="font-weight:normal;"> {% i18n "UEFI boot" %}</label>

                <div class="col-sm-4">
                    {% if not domain.useUEFI %}
                        <input type="submit" class="btn btn-md btn-default" name="set_uefi"
                               value="{% i18n "Enable" %}">
                    {% else %}
                        <input type="submit" class="btn btn-md btn-default" name="unset_uefi"
                               value="{% i18n "Disable" %}">
                    {% endif %}
                </div>
            </div>
        </form>
        <form class="form-horizontal" method="post" role="form">{% c_csrf_token %}
            <div class="form-group">
                <label class="col-sm-4 control-label" style="font-weight:normal;">{% i18n "Description" %}</label>

                <div class="col-sm-4">
                    <input type="text" class="form-control" name="description" value="{{ domain.description }}"/>
                </div>
            </div>
            <p style="font-weight:bold;">{% i18n "Logical host CPUs:" %} {{ vcpu_host }}</p>

            <div class="form-group">
                <label class="col-sm-4 control-label"
                       style="font-weight:normal;"> {% i18n "Current allocation" %}</label>

                <div class="col-sm-4">
                    <select id="cur_vcpu" name="cur_vcpu" class="form-control">
                        {% for cpu in vcpu_range %}
                            {% if domain.currentVcpu %}
                                <option value="{{ cpu }}" {% if cpu == domain.currentVcpu %}selected{% endif %}>{{ cpu }}</option>
                            {% else %}
                                <option value="{{ cpu }}" {% if cpu == domain.vcpu %}selected{% endif %}>{{ cpu }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label"
                       style="font-weight:normal;">{% i18n "Maximum allocation" %}</label>

                <div class="col-sm-4">
                    <select id="vcpu"  name="vcpu" class="form-control">
                        {% for cpu in vcpu_range %}
                            <option value="{{ cpu }}" {% if cpu == domain.vcpu %}selected{% endif %}>{{ cpu }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <p style="font-weight:bold;">{% i18n "Total host memory:" %} {{ memory_host }}<!--|filesizeformat--></p>

            <div class="form-group">
                <label class="col-sm-4 control-label"
                       style="font-weight:normal;">{% i18n "Current allocation" %} ({% i18n "MiB" %})</label>

                <div class="col-sm-4 js-custom__container">
                    <select id="cur_memory" name="cur_memory" class="form-control js-custom__toggle">
                        {% for mem in memory_range %}
                            <option value="{{ mem }}"
                                    {% if mem == domain.currentMemoryMiB %}selected{% endif %}>{{ mem }}</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="cur_memory_custom" class="form-control js-custom__toggle" style="display: none" />
                    <small><input type="checkbox" class="js-custom__checkbox" /> {% i18n "Custom value" %}</small>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label"
                       style="font-weight:normal;">{% i18n "Maximum allocation" %} ({% i18n "MiB" %})</label>

                <div class="col-sm-4 js-custom__container">
                    <select id="memory" name="memory" class="form-control js-custom__toggle">
                        {% for mem in memory_range %}
                            <option value="{{ mem }}"
                                    {% if mem == domain.memoryMiB %}selected{% endif %}>{{ mem }}</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="memory_custom" class="form-control js-custom__toggle" style="display: none" />
                    <small><input type="checkbox" class="js-custom__checkbox" /> {% i18n "Custom value" %}</small>
                </div>
            </div>
            {% if domain.status == 5 %}
                <button type="submit" class="btn btn-lg btn-primary pull-left"
                        name="change_settings" onclick="return getData()">{% i18n "Change" %}</button>
                <script>
                    function getData() {
                        var select_memory = document.getElementById("memory").value;
                        var select_cur_memory = document.getElementById("cur_memory").value;

                        var select_vcpu = document.getElementById("vcpu").value;
                        var select_cur_vcpu = document.getElementById("cur_vcpu").value;

                        var check_memory = parseInt(select_memory);
                        var check_cur_memory = parseInt(select_cur_memory);
                        var check_vcpu = parseInt(select_vcpu);
                        var check_cur_vcpu = parseInt(select_cur_vcpu);

                        if (check_vcpu < check_cur_vcpu && check_memory < check_cur_memory) {
                            return confirm('{% i18n "Both CPU and Memory current allocations are greater than maximum allocations. Current allocations will get the same values as maximum allocations. Are you sure?" %}');
                        }
                        else if (check_memory < check_cur_memory) {
                            return confirm('{% i18n "Memory current allocation is greater than maximum allocation. Current allocation will get the same value as maximum allocation. Are you sure?" %}');
                        }
                        else if (check_vcpu < check_cur_vcpu) {
                            return confirm('{% i18n "CPU current allocation is greater than maximum allocation. Current allocation will get the same value as maximum allocation. Are you sure?" %}');
                        }
                    }
                </script>
            {% else %}
                <button class="btn btn-lg btn-primary pull-left disabled">{% i18n "Change" %}</button>
            {% endif %}
        </form>
        <div class="clearfix"></div>
    </div>
    <div class="tab-pane tab-inst" id="instancemedia">
        <form class="form-horizontal" action="" method="post" role="form">{% c_csrf_token %}
            {% for cd in domain.media %}
	   {% if forloop.counter0  == 0 %}  
	          <div class="col-sm-3" style="text-align:right;font-weight:bold">{% i18n "Device" %}</div> 
	          <div class="col-sm-4" style="text-align:left;font-weight:bold">{% i18n "Media" %}</div> 
	          <div class="col-sm-2" style="text-align:left;font-weight:bold">{% i18n "Boot from" %}</div><br> 
		  {% endif %}
                <div class="form-group">
                    <label class="col-sm-3 control-label">{% i18n "CDROM" %} {{ forloop.counter }}</label>
                    {% if not cd.image %}
                        <div class="col-sm-4">
                            <select name="media" class="form-control">
                                {% if host.isoMedia.size %}
                                    {% for iso in host.isoMedia %}
                                        <option value="{{ iso.path }}">{{ iso.name }}</option>
                                    {% endfor %}
                                {% else %}
                                    <option value="none">{% i18n "None" %}</option>
                                {% endif %}
                            </select>
                        </div>
			<div class="col-sm-2">
			   <input type="checkbox"  name="{{ cd.dev }}" id="boot_from_{{ forloop.counter }}" {% if cd.bootorder != '' %} checked {% else %} unchecked {% endif %} >
                        </div>
                        <div class="col-sm-2">
                            {% if host.isoMedia.size and  domain.status == 5 %}
                                <button type="submit" class="btn btn-primary btn-sm pull-left" value="{{ cd.dev }}"
                                        name="mount_iso">{% i18n "Connect" %}</button>
                            {% else %}
                                <button class="btn btn-primary btn-sm pull-left disabled"
                                        name="mount_iso">{% i18n "Connect" %}</button>
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="col-sm-4">
                            <p>{{ cd.image }}</p>
                        </div>
			<div class="col-sm-2">
			   <input type="checkbox"   name="{{ cd.dev }}" id="boot_from_{{ forloop.counter }}" {% if cd.bootorder != '' %} checked {% else %} unchecked {% endif %} >
                        </div>
                        <div class="col-sm-2">
                            <input type="hidden" name="path" value="{{ cd.path }}">
                            <button type="submit" class="btn btn-primary btn-sm pull-left" value="{{ cd.dev }}"
                                    name="umount_iso" {% if domain.status != 5 %}  disabled {% endif %}  >{% i18n "Disconnect" %}</button>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </form>
        <div class="clearfix"></div>
    </div>
    <div class="tab-pane tab-inst" id="instancenetworks">
     {% if domain.status == 5 %}
        <a data-toggle="modal" href="#addNic" class="btn btn-primary pull-left">{% i18n "Add Network" %}</a>
     {% endif %}
     <hr>
    <form class="form-horizontal" action="" method="post" role="form">{% c_csrf_token %}
                  <div class="col-sm-1" style="text-align:right;font-weight:bold">{% i18n "Device" %}</div>
                  <div class="col-sm-3" style="text-align:left;font-weight:bold">{% i18n "Network" %}</div>
                  <div class="col-sm-3" style="text-align:left;font-weight:bold">{% i18n "Mac" %}</div>
                  <div class="col-sm-3" style="text-align:left;font-weight:bold">{% i18n "Type" %}</div><br><br>
      <!-- p style="font-weight:bold;Font-size:14pt">{% i18n "Network devices" %}</p -->
        <div class="col-sm-1">
            {% for network in domain.networks %}
                <p style="text-align: left;">eth{{ forloop.counter0 }}</p>
            {% endfor %}
        </div>
        <div class="col-sm-3">
            {% for network in domain.networks %}
               <select name="network_source" class="form-control">
                    {% for net in networks %}
                        <option value="{{ net.name }}" {% if  net.name  == network.nic %}selected{% endif %}>{{ net.name }} </option>
                    {% endfor %}
              </select>
            {% endfor %}
        </div>
        <div class="col-sm-3">
            {% for network in domain.networks %}
		    <input type="text" class="form-control" name="network_mac" value="{{ network.mac }}" readonly style="border: none; background-color: transparent;"/>
            {% endfor %}
        </div>
         {% for network in domain.networks %}
            <div class="col-sm-3">
                <select name="network_type" class="form-control">
                   <option value="virtio" {% if network.type == "virtio"  %}selected{% endif %}>virtio</option>
                   <option value="e1000" {% if network.type == "e1000"  %}selected{% endif %}>e1000</option>
                   <option value="rtl8139" {% if network.type == "rtl8139"  %}selected{% endif %}>rtl8139</option>
                </select>   	    
             </div>	
             <div class="col-sm-2">
             <button name="remove-nic-{{ forloop.counter0 }}" type="button" class="btn btn-default btn-sm removePane" 
                        onclick="callback_remove_nic('{{ network.mac }}')"
                                           {% i18n "Remove_nic" %} {% if domain.status != 5 %} disabled  {% endif %}>
                                  <span class="fas fa-minus"></span>
              </button>
	     </div>  
          {% endfor %}
        <div class="clearfix"></div>
        {% if domain.status == 5 %}
             <button type="submit" class="btn btn-lg btn-primary pull-left"
                    name="change_net">{% i18n "Change" %}</button>
        {% else %}
             <button class="btn btn-lg btn-primary pull-left disabled">{% i18n "Change" %}</button>
        {% endif %}
     </form>
    </div>
    <div class="tab-pane tab-inst" id="instancedisks">
     {% if domain.status == 5 %} 
       <a data-toggle="modal" href="#addDisk" class="btn btn-primary pull-left">{% i18n "Add Disk" %}</a>
     {% endif %}  
     <hr>
    <form class="form-horizontal" action="" method="post" role="form">{% c_csrf_token %}
        <p style="font-weight:bold;Font-size:14pt">{% i18n "Storage devices" %}</p>
        <div class="col-sm-1" style="text-align:right;font-weight:bold">{% i18n "Device" %}</div>
        <div class="col-sm-4" style="text-align:left;font-weight:bold">{% i18n "File" %}</div>
        <div class="col-sm-1" style="text-align:left;font-weight:bold">{% i18n "Type" %}</div>
	<div class="col-sm-2" style="text-align:left;font-weight:bold">{% i18n "Boot from" %}</div>
        <div class="col-sm-2" style="text-align:left;font-weight:bold">{% i18n "Bus" %}</div><br><br>
        {% for disk in domain.disks %}
        <div class="col-sm-1">
		<input type="text" class="form-control" name="disk_dev" value="{{  disk.dev }}" readonly style="border: none; background-color: transparent;"/>
        </div>
        <div class="col-sm-4">
               <select name="disk_source" class="form-control">
	            <option selected="selected">{{ disk.path }} </option>
                    {% for img in get_images %}
			 <option value="{{ img.path }}">{{ img.path }} </option>
                    {% endfor %}
              </select>
        </div>
        <div class="col-sm-1">
                <p>{{ disk.format }}</p>
        </div>
        <div class="col-sm-2">
           <input type="checkbox"   name="boot_from_{{ disk.dev }}" id="boot_from_{{ disk.dev }}" {% if disk.bootorder != '' %} checked {% else %} unchecked {% endif %} >
        </div>
            <div class="col-sm-2">
	        <select name="disk_bus" class="form-control">
   		   <option value="virtio" {% if disk.bus == "virtio"  %}selected{% endif %}>virtio</option>
   		   <option value="sata" {% if disk.bus == "sata"  %}selected{% endif %}>sata</option>
   		   <option value="scsi" {% if disk.bus == "scsi"  %}selected{% endif %}>scsi</option>
		</select>   
           </div>
        <div class="col-sm-1">
	      <button name="remove-disk-{{ forloop.counter0 }}" type="button" class="btn btn-default btn-sm removePane" 
	                onclick="callback_remove_disk('{{ disk.dev }}')"
			                   {% i18n "Remove_disk" %} {% if domain.status != 5 %} disabled  {% endif %}>
				  <span class="fas fa-minus"></span>
    	      </button>
        </div>
        <div class="clearfix"></div>
        {% endfor %}
        
        {% if domain.status == 5 %}
             <button type="submit" class="btn btn-lg btn-primary pull-left"
                    name="change_disk">{% i18n "Change" %}</button>
        {% else %}
             <button class="btn btn-lg btn-primary pull-left disabled">{% i18n "Change" %}</button>
        {% endif %}
     </form>
    </div>
    <div class="tab-pane tab-inst" id="instanceclone">
        <p style="font-weight:bold;">{% i18n "Create a clone" %}</p>

        <form class="form-horizontal" action="" method="post" role="form">{% c_csrf_token %}
            <div class="form-group">
                <label class="col-sm-3 control-label" style="font-weight:normal;">{% i18n "Clone Name" %}</label>

                <div class="col-sm-3">
                    <input class="form-control" type="hidden"  name="old-name" value="{{ domain.name }}"/>
                    <input type="text" class="form-control" name="clone-name" value="{{ domain.name }}-clone"/>
                </div>
            </div>
           {% if domain.status == 5 %}
                <button type="submit" class="btn btn-primary btn-lg pull-left"
                        name="clone_instance">{% i18n "Clone" %}</button>
            {% else %}
                <button class="btn btn-primary btn-lg pull-left disabled" name="clone_instance">{% i18n "Clone" %}</button>
            {% endif %}
        </form>
        <div class="clearfix"></div>
    </div>
    </div>
    </div>
    <div class="tab-pane" id="snapshots">
        <ul class="nav nav-tabs" style="margin-top: 20px">
            <li class="active"><a href="#createsnapshot" id="snapshots_create" data-toggle="tab">{% i18n "Create Snapshot" %}</a></li>
            <li><a href="#instaceshapshosts" id="snapshots_restore"  data-toggle="tab">{% i18n "Restore from Snapshot" %}</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane tab-inst active" id="createsnapshot">
                <p>{% i18n "To take a snapshot, shutdown the instance." %}</p>

                <form class="form-horizontal" method="post" role="form">{% c_csrf_token %}
                    <div class="form-group">
                        <label for="snapshot" class="col-sm-2 control-label">{% i18n "Name" %}</label>

                        <div class="col-sm-4">
                            <input type="text" class="form-control" name="name" placeholder="{% i18n "Name" %}"
                                   maxlength="14">
                        </div>
                    </div>
                    {% if domain.status == 5 and domain.can_take_snapshots %}
                        <button type="submit" class="btn btn-primary btn-lg pull-left"
                                name="snapshot">{% i18n "Create Snapshot" %}</button>
                    {% else %}
                        <button class="btn btn-primary btn-lg pull-left disabled">{% i18n "Create Snapshot" %}</button>
                    {% endif %}
                </form>
                <div class="clearfix"></div>
            </div>
            <div class="tab-pane tab-inst" id="instaceshapshosts">
                <p>{% i18n "To revert to a snapshot, shutdown the instance" %}</p>
                {% if domain.snapshots.size %}
                    <table class="table table-bordered">
                        <thead>
                        <tr class="active">
                            <th>{% i18n "Name" %}</th>
                            <th>{% i18n "Date" %}</th>
                            <th colspan="2">{% i18n "Action" %}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for snap in domain.snapshots %}
                            <tr>
                                <td><strong>{{ snap.name }}</strong></td>
                                <td>{{ snap.date }}<!--|date:"M d H:i:s"--></td>
                                <td style="width:30px;">
                                    <form action="" method="post" style="height:10px" role="form">{% c_csrf_token %}
                                        <input type="hidden" name="name" value="{{ snap.name }}">
                                        {% if domain.status == 5 %}
                                            <button type="submit" class="btn btn-sm btn-primary" name="revert_snapshot"
                                                    onclick="return confirm('Are you sure?')">{% i18n "Revert" %}</button>
                                        {% else %}
                                            <button type="button"
                                                    class="btn btn-sm btn-primary disabled">{% i18n "Revert" %}</button>
                                        {% endif %}
                                    </form>
                                </td>
                                <td style="width:30px;">
                                    <form action="" method="post" role="form">{% c_csrf_token %}
                                        <input type="hidden" name="name" value="{{ snap.name }}">
                                        <button type="submit" class="btn btn-sm btn-danger" name="delete_snapshot"
                                                onclick="return confirm('{% i18n "Are you sure?" %}')">{% i18n "Delete" %}</button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>{% i18n "You do not have any snapshots" %}</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="tab-pane" id="graph">
        <ul class="nav nav-tabs" style="margin-top: 20px">
            <li class="active"><a href="#statistics" data-toggle="tab">{% i18n "Instance Statistics" %}</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane tab-inst active" id="statistics">
                <div id="chart-cpu-usage">
                </div>
                <div id="chart-disk-usage">
                </div>
                <div id="chart-net-usage">
                </div>
            </div>
        </div>
    </div>
    <div class="tab-pane" id="migrate">
        <ul class="nav nav-tabs" style="margin-top: 20px">
            <li class="active"><a href="#instancemigate" data-toggle="tab">{% i18n "Instance Migrate" %}</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane tab-inst active" id="instancemigate">
                <p style="text-align:center;">
                    <span class="label label-danger">{% i18n "Warning:" %}</span> {% i18n "Both host servers must have equal settings and OS type" %}
                </p>
                <br>

                <div class="row show-grid">
                    <div class="col-sm-3" style="text-align: right;padding-right: 2px;">
                        <p><strong>{% i18n "Original host" %}</strong></p>
                    </div>
                    <div class="col-sm-6">
                        <p style="margin: 10px -10px 0 0;">{{ compute.name }}</p>
                    </div>
                </div>
                <form class="form-horizontal" method="post" role="form">{% c_csrf_token %}
                    <div class="form-group">
                        <label class="col-sm-3 control-label">{% i18n "Host migration" %}</label>

                        <div class="col-sm-6">
                            <select name="compute_id" class="form-control">
                                {% if computes_count != 1 %}
                                    {% for comp in computes %}
                                        {% if comp.id != compute.id %}
                                            <option value="{{ comp.id }}">{{ comp.name }}</option>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">{% i18n "Live migration" %}</label>

                        <div class="col-sm-6">
                            <input type="checkbox" name="live_migrate" value="true" id="vm_live_migrate">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">{% i18n "Unsafe migration" %}</label>

                        <div class="col-sm-6">
                            <input type="checkbox" name="unsafe_migrate" value="true" id="vm_unsafe_migrate">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">{% i18n "Delete original" %}</label>

                        <div class="col-sm-6">
                            <input type="checkbox" name="xml_delete" value="true" id="xml_delete">
                        </div>
                    </div>
                    {% if computes_count != 1 %}
                        <button type="submit" class="btn btn-lg btn-primary pull-left"
                                name="migrate">{% i18n "Migrate" %}</button>
                    {% else %}
                        <button class="btn btn-lg btn-primary pull-left disabled">{% i18n "Migrate" %}</button>
                    {% endif %}
                </form>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
    <div class="tab-pane" id="delete">
        <ul class="nav nav-tabs" style="margin-top: 20px">
            <li class="active"><a id="tab_destroy" href="#destroy" data-toggle="tab">{% i18n "Delete Instance" %}</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane tab-inst active" id="destroy">
                <p>{% i18n "Delete HDD image?" %}</p>

                <form class="form-group" method="post" role="form">{% c_csrf_token %}
                    <div class="checkbox" style="margin-left: 8px;">
                        <label>
                            <input type="checkbox" id="delete_disk" unchecked>
                            <strong><span
                                    class="label label-danger">{% i18n "Warning:" %}</span> {% i18n "If you check this box, Instance's data will be lost!" %}
                            </strong>
                        </label>
                    </div>
                    <button id="btn_delete" type="button" class="btn btn-lg btn-danger pull-left"
                            name="delete" onclick="callback_delete_instance('{{ domain.name }}')">{% i18n "Delete" %} 
			      </button>
                </form>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
    </div>
    </div>

 <!-- Modal Disk -->
    <div class="modal fade" id="addDisk" tabindex="-1" role="dialog" aria-labelledby="addDiskLabel" aria-hidden="true">
     <div class="modal-dialog">
       <div class="modal-content">
          <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">{% i18n "Add New Disk" %}</h4>
                </div>
		<form class="form-horizontal" method="post" role="form">{% c_csrf_token %}
                      <div class="form-group">
                         <label class="col-sm-3 control-label">{% i18n "Files" %}</label>

		        <div class="col-sm-6">
			    <input id="images" name="images" type="hidden" value=""/>
		               <select name="disk_source_add" class="form-control">
		                    {% for img in get_images %}
		                         <option value="{{ img.path }}">{{ img.path }} </option>
		                    {% endfor %}
				</select>    
		        </div>
	              </div>	   

		      <div class="form-group">
                  	     <label class="col-sm-3 control-label">{% i18n "Bus type" %}</label>
                  	     <div class="col-sm-6">
          		      <select  class="form-control" name="new_target_bus" >
          		        <option value="virtio" selected="selected">virtio</option>
          		        <option value="sata">sata</option>
          		        <option value="scsi">scsi</option>
          		      </select>
                            </div>
                       </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">{% i18n "Close" %}</button>
                        <button type="submit" class="btn btn-primary" name="insert_disk">{% i18n "Add" %}</button>
                    </div>
		</form>
       </div>
     </div>
    </div>  


    <div class="modal fade" id="addNic" tabindex="-1" role="dialog" aria-labelledby="addNicLabel" aria-hidden="true">
     <div class="modal-dialog">
       <div class="modal-content">
          <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">{% i18n "Add Network Card" %}</h4>
                </div>
                <form class="form-horizontal" method="post" role="form">{% c_csrf_token %}
                      <div class="form-group">
                         <label class="col-sm-3 control-label">{% i18n "Network"%}</label>

                        <div class="col-sm-6">
                               <select name="new_network" class="form-control">
		                    {% for net in networks %}
		                        <option value="{{ net.name }}">{{ net.name }}</option>
		                    {% endfor %}
                                </select>
                        </div>
                      </div>

                      <div class="form-group">
                             <label class="col-sm-3 control-label">{% i18n "Model Type"%}</label>
                             <div class="col-sm-6">
                              <select  class="form-control" name="new_target_bus" >
                                <option value="virtio" selected="selected">virtio</option>
                                <option value="e1000">e1000</option>
                                <option value="rtl8139">rtl8139</option>
                              </select>
                            </div>
                       </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">{% i18n "Close" %}</button>
                        <button type="submit" class="btn btn-primary" name="insert_nic">{% i18n "Add" %}</button>
                    </div>
                </form>
       </div>
     </div>
    </div>



    {% include 'sidebar_close.html' %}
{% endblock %}
{% block script %}
<script>
    function open_console() {
        window.open('/console/{{ host_id }}/{{ domain.uuid }}', '', 'width=850,height=485')
    }
    function show_console() {
        if ($('#console_show_pass').attr('type') == 'password') {
            $('#console_show_pass').attr('type', 'text');
        } else {
            $('#console_show_pass').attr('type', 'password');
        }
    }
    function random_mac(net) {
        var hexDigits = "0123456789abcdef";
        var macAddress="52:54:00:";
        for (var i=0; i<3; i++) {
            macAddress+=hexDigits.charAt(Math.round(Math.random()*16));
            macAddress+=hexDigits.charAt(Math.round(Math.random()*16));
            if (i != 2) macAddress+=":";
        }
        $('input[name="net-'+net+'"]').val(macAddress);
    };
</script>
<script>
    var hash = location.hash;
    if (~$.inArray(hash, ['#shutdown', '#forceshutdown', '#managedsave', '#suspend'])) {
        var btn = $('#power>ul>li>a');
        $(btn).each(function () {
            if ($(this).attr('href') === hash) {
                $(this).trigger('click');
            }
        });
    }
    if (~$.inArray(hash, ['#console_pass', '#console_keymap', '#console_type'])) {
        var btnsect = $('#btnsection>li>a');
        $(btnsect).each(function () {
            if ($(this).attr('href') === '#access') {
                $(this).trigger('click');
            }
        });
        var btn = $('#access>ul>li>a');
        $(btn).each(function () {
            if ($(this).attr('href') === hash) {
                $(this).trigger('click');
            }
        });
    }
    if (~$.inArray(hash, ['#createsnapshot', '#instaceshapshosts'])) {
        var btnsect = $('#btnsection>li>a');
        $(btnsect).each(function () {
            if ($(this).attr('href') === '#snapshots') {
                $(this).trigger('click');
            }
        });
        var btn = $('#snapshots>ul>li>a');
        $(btn).each(function () {
            if ($(this).attr('href') === hash) {
                $(this).trigger('click');
            }
        });
    }
    if (~$.inArray(hash, ['#instancesettings', '#instancemedia'])) {
        var btnsect = $('#btnsection>li>a');
        $(btnsect).each(function () {
            if ($(this).attr('href') === '#settings') {
                $(this).trigger('click');
            }
        });
        var btn = $('#settings>ul>li>a');
        $(btn).each(function () {
            if ($(this).attr('href') === hash) {
                $(this).trigger('click');
            }
        });
    }
</script>
<script>
    $(document).on('change', '#console_passwd_gen', function () {
        if ($(this).prop('checked')) {
            $('#console_passwd_manual').hide();
            $('#console_passwd_clear').prop('checked', false);
        } else {
            $('#console_passwd_manual').show();
        }
    });
    $(document).on('change', '#console_passwd_clear', function () {
        if ($(this).prop('checked')) {
            $('#console_passwd_manual').hide();
            $('#console_passwd_gen').prop('checked', false);
        } else {
            $('#console_passwd_manual').show();
        }
    });
    $(document).on('change', '#console_keymap_clear', function () {
        if ($(this).prop('checked')) {
            $('#console_keymap_selection').hide();
        } else {
            $('#console_keymap_selection').show();
        }
    });
    $(document).ready(function () {
        // set current console keymap or fall back to default
        var keymap = "{{ domain.consoleKeymap }}"
        if (keymap != '') {
            $("#console_select_keymap option[value='" + keymap + "']").prop('selected', true);
        }
    });
    $(document).ready(function () {
        // set current console type or fall back to default
        var console_type = "{{ domain.consoleType }}"
        if (console_type != '') {
            $("#console_select_type option[value='" + console_type + "']").prop('selected', true);
        }
    });




$(document).ready(function () {
    $('a[data-toggle="tab"]').on('show.bs.tab', function(e) {
        var m=$(e.target).attr('id');
        if (typeof m == 'undefined') return;
	m=m.split("_");
       if (m[0] == 'tab' )
	     localStorage.setItem('activeTabM',m[1]);
	else
	     localStorage.setItem('activeTabD', $(e.target).attr('href'));

    });
    var activeTabM = localStorage.getItem('activeTabM');
    var activeTabD = localStorage.getItem('activeTabD');
    if(activeTabM)
        $('#btnsection a[href="#' + activeTabM + '"]').tab('show');
    if(activeTabD)
        $('#' + activeTabM +' a[href="' + activeTabD + '"]').tab('show');
});


</script>
<script>
    $(function () {
        // window.setInterval('instusage()', {{ time_refresh }});
	if (is_function("ShowAlert")){
              ShowAlert();
	  }    
	if (is_function("ShowMessage")){
	      ShowMessage();
	  }    
    });
</script>
<script>
     function is_function(func) {
        return typeof window[func] !== 'undefined' && $.isFunction(window[func]);
     }
    $(function () {
        $('.js-custom__checkbox').change(function () {
            var container  = $(this).closest('.js-custom__container');
            var toggles     = container.find('.js-custom__toggle');
            toggles.toggle();
        });
    });
</script>


// <script>
//      window.setInterval(function get_status() {
//          var status = {{ domain.status }};
//          $.getJSON('/info/inst_status/{{ host_id}}/{{ domain.name }}', function (data) {
//              if (data['status'] != status) {
//                  window.location.reload()
//              }
//          })
//      }, {{ time_refresh }});
// </script>
<script>

function callback_delete_instance(inst,check) {
       var vm2remove=inst;

       return eModal
                .confirm('Are you sure to want to delete the instance: ' + inst + '?','Attention')
                .then(
                    function () { 
                            var form = document.createElement("form");
                            var element1 = document.createElement("input");
                            var element2 = document.createElement("checkbox");
                            var csrf = document.createElement("input");
                            csrf.type="hidden";
                            csrf.value="{{ csrf_token }}";
                            csrf.name="csrfprotectiontoken";
                            form.method = "POST";

                            element1.value=inst;
                            element1.name="delete";
                            element2= document.getElementById('delete_disk');
                            element2.name="delete_disk";
                            form.appendChild(element1);
                            form.appendChild(element2);
                            form.appendChild(csrf);


                            document.body.appendChild(form);

                            form.submit();

                             }
                    );

  }


function callback_remove_disk(disk) {
       var disk2remove=disk;
       return eModal
                .confirm('Are you sure to remove the ' + disk + ' Hard Disk?','Attention')
                .then(
                    function () { 
			    var form = document.createElement("form");
			    var element1 = document.createElement("input");
			    var csrf = document.createElement("input");
                            csrf.type="hidden";
                            csrf.value="{{ csrf_token }}";
                            csrf.name="csrfprotectiontoken";
		            form.method = "POST";

			    element1.value=disk2remove;
			    element1.name="remove_disk";
			    form.appendChild(element1);
			    form.appendChild(csrf);


			    document.body.appendChild(form);

			    form.submit();

			     }
                    );

  }

function callback_remove_nic(mac) {
       var nic2remove=mac;
       return eModal
                .confirm('Are you sure to remove the network card with the mac:' + mac + '?','Attention')
                .then(
                    function () { 
			    var form = document.createElement("form");
			    var element1 = document.createElement("input");
                            var csrf = document.createElement("input");
                            csrf.type="hidden";
                            csrf.value="{{ csrf_token }}";
                            csrf.name="csrfprotectiontoken";
                            form.method = "POST";

			    element1.value=nic2remove;
			    element1.name="remove_nic";
			    form.appendChild(element1);
			    form.appendChild(csrf);


			    document.body.appendChild(form);

			    form.submit();

			     }
                    );

  }
</script>
<script type="text/javascript">

//window.addEventListener("beforeunload", function (e) {
//    insts_status_source.close();
//});


//var insts_status_source = new EventSource('/info/events/{{ host_id }}/2');

//insts_status_source.onmessage = function (event) {
event_source.addEventListener("all_vm_status", function(event) {
             var data=JSON.parse(event.data);

                for (var i = 0; i < data.length; i++) 
                    if( ( data[i]['name'] === '{{ domain.name }}') && (data['status'] != status))
                              window.location.reload();
               
});        


//var s_insts_status_source = new EventSource('/info/events/{{ host_id }}/3/{{ domain.name }}');
//var status = {{ domain.status }};
//
//
//
//
//
//window.addEventListener("beforeunload", function (e) {
//    s_insts_status_source.close();
//});
//
//
//s_insts_status_source.addEventListener("single_vm_status", function(event) {
//             var data=JSON.parse(event.data);
//             if (data['status'] != status) {
//                   window.location.reload()
//              } 
//});	     
//

  google.charts.setOnLoadCallback(drawChart); 

    var selectedTabHash;
  $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
    // here is the new selected tab id
    selectedTabHash = e.target.hash;
});

  function drawChart() {
       
        var line_options_cpu = {
                                  curveType: 'function',
				  title: 'CPU Usage %',
				  legend:'bottom',
				  height: 250,
                                  vAxis: {
                                        viewWindow: {
                                           min: 0,
                                           max: 100
                                          }
                                  },
                                  hAxis: { 
                                    format:'HH:mm:ss',
                                    gridlines: {count: 7}
                                    }
                                };

        var line_options_disks = {
                                  curveType: 'function',
				  title: 'Disk Usage',
				  height: 250,
				  legend:'bottom',
				  vAxis: {
				        title: 'Disk IO(Mib/s',
				        viewWindow: { 
					    min: 0
					  }    
					}, 
                                  hAxis: { 
                                    format:'HH:mm:ss',
                                    gridlines: {count: 7}
                                    }
                                };

        var line_options_net = {
                                  curveType: 'function',
				  title: 'Network Usage',
				  height: 250,
				  legend:'bottom',
				  vAxis: {
				        title: 'Bandwidth(Mib/s',
				        viewWindow: { 
					    min: 0
					  }    
					}, 
                                  hAxis: { 
                                    format:'HH:mm:ss',
                                    gridlines: {count: 7}
                                    }
                                };



 if (document.getElementById('chart-cpu-usage') != null) {
              var data_chart_cpu_usage = new google.visualization.DataTable();
                  data_chart_cpu_usage.addColumn('date', 'Time');
                  data_chart_cpu_usage.addColumn('number', 'CPU %');
                  // data_chart_cpu_usage.addRow([new Date(),parseFloat({{ host.allMemUsage }})]);

                   var chart_cpu_usage = new google.visualization.LineChart(document.getElementById('chart-cpu-usage'));
                   chart_cpu_usage.draw(data_chart_cpu_usage, line_options_cpu);
            }

 if (document.getElementById('chart-disk-usage') != null) {
              var data_chart_disk_usage = new google.visualization.DataTable();
                  data_chart_disk_usage.addColumn('date', 'Time');

                  {% for disk in domain.disks %}
                      data_chart_disk_usage.addColumn('number', '{{ disk.dev }}-read');
                      data_chart_disk_usage.addColumn('number', '{{ disk.dev }}-write');
		  {% endfor %} 

                   var chart_disk_usage = new google.visualization.LineChart(document.getElementById('chart-disk-usage'));
                   chart_disk_usage.draw(data_chart_disk_usage, line_options_disks);
            }
 
 if (document.getElementById('chart-net-usage') != null) {
              var data_chart_net_usage = new google.visualization.DataTable();
                  data_chart_net_usage.addColumn('date', 'Time');

                  {% for net in domain.networks  %}
                      data_chart_net_usage.addColumn('number', '{{ net.dev }}-rx');
                      data_chart_net_usage.addColumn('number', '{{ net.dev }}-tx');
		  {% endfor %} 

                   var chart_net_usage = new google.visualization.LineChart(document.getElementById('chart-net-usage'));
                   chart_net_usage.draw(data_chart_net_usage, line_options_net);
            }


 setInterval(function() {
	if (selectedTabHash != "#graph") 
	     return;   

           $.getJSON('/info/instusage/{{ host_id }}/{{ domain.name }}', function (result) {

                     if (document.getElementById('chart-cpu-usage') != null) {
                          data_chart_cpu_usage.addRow([new Date(),parseFloat(result['cpu']['data'][0])]);
                          chart_cpu_usage.draw(data_chart_cpu_usage, line_options_cpu);
                     }
                     if (document.getElementById('chart-disk-usage') != null) {
		          var hdd = result['hdd'];
                          var rows_h=[];
                         {% for disk in domain.disks %}
                              for(var i in hdd)
			         if (hdd[i]['dev'] == '{{ disk.dev }}') 
                                          rows_h.push([hdd[i]['data']]);
		         {% endfor %} 
                     
                          data_chart_disk_usage.addRow(
			                  [ 
					     new Date(),
                                           {% for disk in domain.disks %}
					      {% if forloop.counter0  != 0 %},{% endif %}
   					                parseFloat(rows_h[{{ forloop.counter0 }}][0]['rd'][0]),
   					                parseFloat(rows_h[{{ forloop.counter0 }}][0]['wr'][0])
		                           {% endfor %} 
					   ]);
                          chart_disk_usage.draw(data_chart_disk_usage, line_options_disks);
                          }
                       if (document.getElementById('chart-net-usage') != null) {
                          var net = result['net'];
                          var rows_n=[];
                         {% for network in domain.networks %}
                              for(var i in net)
                                 if (net[i]['dev'] == '{{ network.dev }}')
                                          rows_n.push([net[i]['data']]);
                         {% endfor %}


                          data_chart_net_usage.addRow(
			                  [ 
					     new Date(),
                                           {% for network in domain.networks %}
					      {% if forloop.counter0  != 0 %},{% endif %}
   					                parseFloat(rows_n[{{ forloop.counter0 }}][0]['rx'][0]),
   					                parseFloat(rows_n[{{ forloop.counter0 }}][0]['tx'][0])
		                           {% endfor %} 
					   ]);
                          chart_net_usage.draw(data_chart_net_usage, line_options_net);
                     }

});
        }, {{ time_refresh }});


}

//function onlyOne(checkbox) {
//    var checkboxes = document.querySelectorAll('[name^=sd]')
//    checkboxes.forEach((item) => {
//        if (item !== checkbox) item.checked = false
//    })
//}

</script>

{% endblock %}
